const Data={smite:[{1:390},{2:410},{3:430},{4:450},{5:480},{6:510},{7:540},{8:570},{9:600},{10:640},{11:680},{12:720},{13:760},{14:800},{15:850},{16:900},{17:950},{18:1e3}]};class GameManager extends pc.ScriptType{initialize(){this.app.hp=0,this.app.playing=!1,this.app.MAX_HP=this.hp,this.app.on("game:manager:init",this._handleInit,this),this.app.on("game:manager:start",this._handleStart,this),this.app.on("game:manager:end",this._handleEnd,this),this.app.fire("game:manager:init"),this.app.sleep=a=>new Promise((t=>setTimeout(t,a)))}_handleInit(){this.app.type="noaml",this.app.playing=!1,this.app.fire("game:manager:start")}_handleStart(){this.app.hp=this.hp,this.app.playing=!0,this.app.fire("game:main:start")}async _handleEnd(){this.app.fire("game:manager:init")}update(){}}pc.registerScript(GameManager),GameManager.attributes.add("hp",{type:"number",default:4090});class HpText extends pc.ScriptType{update(){this.entity.element.text=this.app.hp}}pc.registerScript(HpText);class MainScene extends pc.ScriptType{initialize(){this.counter=0,this.isAttack=!1,this.playing=!0,this.app.level=1,this.app.smiteDamage=this.smiteDamage,this.app.touch&&this.app.touch.on(pc.EVENT_TOUCHSTART,(()=>{this.app.fire("game:smite:fire")})),this.app.keyboard.on(pc.EVENT_KEYDOWN,this._handleKeyDown,this),this.app.on("game:smite:fire",this._handleSmite,this),this.app.on("game:attack:fire",this._handleAttack,this),this.app.on("game:level:change",this._handleLevelChange,this),this.app.on("game:manager:end",this._handleEnd,this),this.app.on("game:main:start",this._handleStart,this)}get _isAttack(){return this.delay<this.counter}_handleStart(){this.enemyTemplate.resource.instantiate()}async _handleEnd(){const e=this.app.root.findByTag("enemy")[0],{TweenScale:t}=e.script;this.app.fire("sound:game:end:play"),e.element.opacity=.8,t.enabled=!0,await this.app.sleep(400),t.enabled=!1,e.element.opacity=1,e.setLocalScale(1,1,1)}_handleKeyDown(e){const{event:t}=e,{key:a}=t;this.keys.includes(a)&&this.app.fire("game:smite:fire")}_handleSmite(){const e=this.app.hp;if(this.app.hp=this.app.hp-this.app.smiteDamage,this.app.hp<0){this.app.fire("sound:game:smite:play"),console.log(this.app.hp),this.playing=!1,this.app.fire("game:result-ui:show",{type:"good",text:`Good\nHP: ${e}\nSmite Damage: ${this.app.smiteDamage}\nResult : ${this.app.smiteDamage-e}\n`}),this.app.level++;const t=this.comboTextTemplate.resource.instantiate();t.element.text=`Combo ${String(this.app.level)}`,t.reparent(this.app.root.findByName("main"))}else{this.app.fire("sound:game:smite-failed:play");const e=this.comboMinusTextTemplate.resource.instantiate();e.element.text=` ${this.app.hp}`,e.reparent(this.app.root.findByName("main")),this.app.level>1&&this.app.level--}this.app.fire("game:level:change")}_handleLevelChange(){}_handleAttack(){const e=Math.floor(this.baseDamage*(Math.random()+1));this.app.hp=this.app.hp-e,this.app.fire("sound:game:attack:play"),this.counter=0;const t=this.damageTemplate.resource.instantiate();t.element.text=e,t.reparent(this.app.root.findByName("main"))}update(e){this._isAttack?this.app.fire("game:attack:fire"):this.counter=this.counter+Math.random()*e,this.app.hp<0&&this.app.fire("game:manager:end")}}pc.registerScript(MainScene),MainScene.attributes.add("baseDamage",{type:"number",default:100}),MainScene.attributes.add("delay",{type:"number",title:"HP減少速度",default:.2}),MainScene.attributes.add("smiteDamage",{type:"number",title:"レベル",default:9,enum:[{1:390},{2:410},{3:430},{4:450},{5:480},{6:510},{7:540},{8:570},{9:600},{10:640},{11:680},{12:720},{13:760},{14:800},{15:850},{16:900},{17:950},{18:1e3}]}),MainScene.attributes.add("keys",{type:"string",title:"スマイトキー",array:!0}),MainScene.attributes.add("damageTemplate",{type:"asset",assetType:"template"}),MainScene.attributes.add("comboTextTemplate",{type:"asset",assetType:"template"}),MainScene.attributes.add("comboMinusTextTemplate",{type:"asset",assetType:"template"}),MainScene.attributes.add("enemyTemplate",{type:"asset",assetType:"template"});class SmiteDamageText extends pc.ScriptType{update(){this.entity.element.text=this.app.smiteDamage}}pc.registerScript(SmiteDamageText);class SoundManager extends pc.ScriptType{initialize(){for(let e of Object.values(this.entity.sound.slots))this.app.on(`${e.name}:play`,(()=>{this.entity.sound.play(e.name)}))}}pc.registerScript(SoundManager);class BackgroundUi extends pc.ScriptType{initialize(){this.app.on("game:smite:fire",this._handleSmite,this)}async _handleSmite(){this.entity.element.opacity=.5,await this.app.sleep(500),this.entity.element.opacity=1}update(){}}pc.registerScript(BackgroundUi);class HpBarUi extends pc.ScriptType{initialize(){this.app.on("game:attack:fire",this._handleAttack,this)}async _handleAttack(){this.entity.element.opacity=.8,await this.app.sleep(this.sleep),this.entity.element.opacity=1}update(){}}pc.registerScript(HpBarUi),HpBarUi.attributes.add("sleep",{type:"number",default:100});pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this},from:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,n,s,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),n&&this.delay(n),s&&this.repeat(s),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,n;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,n))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,n=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(i,e,n))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,n,s=0===this.duration?1:this.time/this.duration,r=this.easing(s);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],n=this._ev[h],this.target[h]=e+(n-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceIn=function(t){return 1-BounceOut(1-t)},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,n=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/n)*.5+1)}}}()),function(){pc.Application.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.Application.getApplication();t&&t.addTweenManager()}();class TweenTranslate extends pc.ScriptType{initialize(){const t=this.entity.getLocalPosition();this.entity.tween(t).to(this.to,this.duration,pc[this.easing]).yoyo(this.yoyo).loop(this.loop).on("complete",(()=>{this.entity.destroy()})).start()}}pc.registerScript(TweenTranslate),TweenTranslate.attributes.add("to",{type:"vec3",default:[3,0,0]}),TweenTranslate.attributes.add("duration",{type:"number",default:3}),TweenTranslate.attributes.add("yoyo",{type:"boolean",default:!0}),TweenTranslate.attributes.add("loop",{type:"boolean",default:!0}),TweenTranslate.attributes.add("easing",{type:"string",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}]});class ResultTextUi extends pc.ScriptType{initialize(){this.app.on("game:result-ui:show",(({type:t,text:e})=>{"bad"===t?this.entity.element.color=(new pc.Color).fromString("A31C1C"):"good"===t&&(this.entity.element.color=(new pc.Color).fromString("4AFF61")),this.entity.element.text=e}),this)}}pc.registerScript(ResultTextUi);class LevelText extends pc.ScriptType{async initialize(){await this.app.sleep(500),this.entity.destroy()}}pc.registerScript(LevelText);class HpBar extends pc.ScriptType{initialize(){this.init(),this.app.on("game:attack:fire",this._setHpBar,this)}init(){}_removeHpInstances(){const t=this.app.root.findByTag("hp");if(t&&t.length)for(let e of t){if(!e)return;e.destroy()}}_setHpBar(){const t=this.app.MAX_HP/this.MAX_SIZE,e=Math.floor(this.app.hp/t);this._removeHpInstances();for(let t=0;t<e;t++){const e=this.HpTemplate.resource.instantiate();e.setLocalPosition(32*t-321.011,8.025,0),e.reparent(this.entity)}}update(){}}pc.registerScript(HpBar),HpBar.attributes.add("HpTemplate",{type:"asset",assetType:"template"}),HpBar.attributes.add("MAX_SIZE",{type:"number",default:21});class TweenScale extends pc.ScriptType{initialize(){const t=this.entity.getLocalScale();this.tween=this.entity.tween(t).to(this.to,this.duration,pc[this.easing]).yoyo(this.yoyo).loop(this.loop),this.tween.start(),this.on("enable",(()=>{this.tween.start()}),this)}}pc.registerScript(TweenScale),TweenScale.attributes.add("to",{type:"vec3",default:[2,2,2]}),TweenScale.attributes.add("duration",{type:"number",default:3}),TweenScale.attributes.add("yoyo",{type:"boolean",default:!0}),TweenScale.attributes.add("loop",{type:"boolean",default:!0}),TweenScale.attributes.add("easing",{type:"string",default:"Linear",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}]});class TweenRotate extends pc.ScriptType{initialize(){const t=this.entity.getLocalEulerAngles();this.entity.tween(t).rotate(this.to,this.duration,pc[this.easing]).yoyo(this.yoyo).loop(this.loop).start()}}pc.registerScript(TweenRotate),TweenRotate.attributes.add("to",{type:"vec3",default:[0,0,180]}),TweenRotate.attributes.add("duration",{type:"number",default:3}),TweenRotate.attributes.add("yoyo",{type:"boolean",default:!0}),TweenRotate.attributes.add("loop",{type:"boolean",default:!0}),TweenRotate.attributes.add("easing",{type:"string",default:"Linear",enum:[{Linear:"Linear"},{QuadraticIn:"QuadraticIn"},{QuadraticOut:"QuadraticOut"},{QuadraticInOut:"QuadraticInOut"},{CubicIn:"CubicIn"},{CubicOut:"CubicOut"},{CubicInOut:"CubicInOut"},{QuarticIn:"QuarticIn"},{QuarticOut:"QuarticOut"},{QuarticInOut:"QuarticInOut"},{QuinticIn:"QuinticIn"},{QuinticOut:"QuinticOut"},{QuinticInOut:"QuinticInOut"},{SineIn:"SineIn"},{SineOut:"SineOut"},{SineInOut:"SineInOut"},{ExponentialIn:"ExponentialIn"},{ExponentialOut:"ExponentialOut"},{ExponentialInOut:"ExponentialInOut"},{CircularIn:"CircularIn"},{CircularOut:"CircularOut"},{CircularInOut:"CircularInOut"},{BackIn:"BackIn"},{BackOut:"BackOut"},{BackInOut:"BackInOut"},{BounceIn:"BounceIn"},{BounceOut:"BounceOut"},{BounceInOut:"BounceInOut"},{ElasticIn:"ElasticIn"},{ElasticOut:"ElasticOut"},{ElasticInOut:"ElasticInOut"}]});